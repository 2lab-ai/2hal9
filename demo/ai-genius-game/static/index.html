<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Genius Game 2025 - HAL9 vs AI</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-cyan: #00ffff;
            --primary-magenta: #ff00ff;
            --primary-yellow: #ffff00;
            --primary-green: #00ff00;
            --bg-dark: #0a0a0a;
            --bg-darker: #050505;
        }
        
        body {
            background: var(--bg-darker);
            color: #fff;
            font-family: 'Orbitron', monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        .container {
            text-align: center;
            max-width: 1200px;
            width: 90%;
        }
        
        .logo {
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(45deg, 
                var(--primary-cyan) 0%, 
                var(--primary-magenta) 50%, 
                var(--primary-yellow) 100%
            );
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 30px rgba(0, 255, 255, 0.8));
            animation: pulse-glow 2s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes pulse-glow {
            0%, 100% { filter: drop-shadow(0 0 30px rgba(0, 255, 255, 0.8)); }
            50% { filter: drop-shadow(0 0 50px rgba(255, 0, 255, 1)); }
        }
        
        .subtitle {
            font-size: 24px;
            color: #aaa;
            margin-bottom: 50px;
            letter-spacing: 2px;
        }
        
        .game-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .game-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--primary-cyan);
            border-radius: 15px;
            padding: 30px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .game-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }
        
        .game-card h3 {
            font-size: 28px;
            margin-bottom: 15px;
            color: var(--primary-cyan);
        }
        
        .game-card p {
            font-size: 16px;
            color: #ccc;
            line-height: 1.5;
        }
        
        .controls {
            margin-top: 50px;
        }
        
        .btn {
            padding: 15px 40px;
            font-size: 20px;
            font-weight: 700;
            border: 2px solid var(--primary-green);
            background: transparent;
            color: var(--primary-green);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 10px;
        }
        
        .btn:hover {
            background: var(--primary-green);
            color: #000;
            box-shadow: 0 0 30px var(--primary-green);
        }
        
        .status {
            margin-top: 30px;
            font-size: 18px;
            color: var(--primary-yellow);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .status.active {
            opacity: 1;
        }
        
        #game-board {
            display: none;
            margin-top: 30px;
        }
        
        #board-canvas {
            border: 2px solid var(--primary-cyan);
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.3);
        }
        
        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--primary-cyan);
            border-radius: 10px;
            padding: 20px;
        }
        
        .consciousness-meter {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary-magenta);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .consciousness-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--primary-cyan) 0%, 
                var(--primary-magenta) 50%, 
                var(--primary-yellow) 100%
            );
            width: 0%;
            transition: width 0.5s ease-out;
        }
        
        /* Neural network background */
        canvas#neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <canvas id="neural-bg"></canvas>
    
    <div class="container">
        <h1 class="logo">AI GENIUS GAME</h1>
        <p class="subtitle">HAL9 Collective Intelligence vs Individual AI</p>
        
        <div id="main-menu">
            <div class="game-menu">
                <div class="game-card" onclick="selectGame('ConsciousnessEmergence')">
                    <h3>의식 출현</h3>
                    <p>뉴런을 배치하여 의식이 출현하는 임계점에 도달하세요</p>
                </div>
                <div class="game-card" onclick="selectGame('MinorityGame')">
                    <h3>소수자 게임</h3>
                    <p>다수의 반대편에 서서 점수를 획득하세요</p>
                </div>
                <div class="game-card" onclick="selectGame('SemanticShapeshifter')">
                    <h3>의미 변환</h3>
                    <p>단어의 의미를 변환하여 상대를 혼란시키세요</p>
                </div>
                <div class="game-card" onclick="selectGame('CollectiveMaze')">
                    <h3>집단 미로</h3>
                    <p>협력과 경쟁을 통해 미로를 탈출하세요</p>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="createNewGame()">새 게임 만들기</button>
                <button class="btn" onclick="joinGame()">게임 참가</button>
            </div>
        </div>
        
        <div id="game-board">
            <canvas id="board-canvas" width="800" height="800"></canvas>
            <div class="game-info">
                <div class="info-panel">
                    <h3>플레이어 정보</h3>
                    <div id="player-info"></div>
                </div>
                <div class="info-panel">
                    <h3>의식 수준</h3>
                    <div class="consciousness-meter">
                        <div class="consciousness-fill" id="consciousness-level"></div>
                    </div>
                    <p id="consciousness-value">0%</p>
                </div>
            </div>
        </div>
        
        <div class="status" id="status"></div>
    </div>
    
    <script>
        let ws = null;
        let gameId = null;
        let selectedGameType = null;
        let gameState = null;
        let playerId = null;
        
        // Neural network background animation
        function initNeuralBackground() {
            const canvas = document.getElementById('neural-bg');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const nodes = [];
            const nodeCount = 50;
            
            for (let i = 0; i < nodeCount; i++) {
                nodes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 3 + 1
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Update nodes
                nodes.forEach(node => {
                    node.x += node.vx;
                    node.y += node.vy;
                    
                    if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
                    if (node.y < 0 || node.y > canvas.height) node.vy *= -1;
                });
                
                // Draw connections
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                nodes.forEach((node1, i) => {
                    nodes.slice(i + 1).forEach(node2 => {
                        const dist = Math.hypot(node1.x - node2.x, node1.y - node2.y);
                        if (dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(node1.x, node1.y);
                            ctx.lineTo(node2.x, node2.y);
                            ctx.globalAlpha = 1 - dist / 150;
                            ctx.stroke();
                        }
                    });
                });
                
                // Draw nodes
                ctx.globalAlpha = 1;
                ctx.fillStyle = '#00ffff';
                nodes.forEach(node => {
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function selectGame(gameType) {
            selectedGameType = gameType;
            showStatus(`선택된 게임: ${gameType}`);
        }
        
        async function createNewGame() {
            if (!selectedGameType) {
                showStatus('먼저 게임을 선택하세요!');
                return;
            }
            
            try {
                const response = await fetch('/api/games/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game_type: { type: selectedGameType },
                        max_rounds: 20
                    })
                });
                
                const data = await response.json();
                gameId = data.id;
                showStatus(`게임이 생성되었습니다! ID: ${gameId}`);
                
                // Connect to game
                connectToGame(gameId);
            } catch (error) {
                showStatus(`오류: ${error.message}`);
            }
        }
        
        function joinGame() {
            const id = prompt('게임 ID를 입력하세요:');
            if (id) {
                connectToGame(id);
            }
        }
        
        function connectToGame(id) {
            gameId = id;
            ws = new WebSocket(`ws://localhost:3456/ws/${gameId}`);
            
            ws.onopen = () => {
                showStatus('게임에 연결되었습니다!');
                
                // Join game
                const playerName = prompt('플레이어 이름:') || 'Player';
                ws.send(JSON.stringify({
                    type: 'join_game',
                    player_name: playerName,
                    player_type: {
                        type: 'hal9_collective',
                        agent_count: 6
                    }
                }));
                
                document.getElementById('main-menu').style.display = 'none';
                document.getElementById('game-board').style.display = 'block';
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleGameMessage(data);
            };
            
            ws.onerror = (error) => {
                showStatus(`연결 오류: ${error}`);
            };
            
            ws.onclose = () => {
                showStatus('연결이 종료되었습니다');
            };
        }
        
        function handleGameMessage(message) {
            if (message.type === 'game_state') {
                gameState = message.state;
                updateGameBoard();
            } else if (message.type === 'error') {
                showStatus(`오류: ${message.message}`);
            }
        }
        
        function updateGameBoard() {
            if (!gameState) return;
            
            const canvas = document.getElementById('board-canvas');
            const ctx = canvas.getContext('2d');
            const cellSize = canvas.width / 19;
            
            // Clear canvas
            ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = 'rgba(0, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 19; i++) {
                ctx.beginPath();
                ctx.moveTo(i * cellSize, 0);
                ctx.lineTo(i * cellSize, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * cellSize);
                ctx.lineTo(canvas.width, i * cellSize);
                ctx.stroke();
            }
            
            // Draw cells
            gameState.board.forEach((row, y) => {
                row.forEach((cell, x) => {
                    if (cell.owner) {
                        const player = Object.values(gameState.players).find(p => p.id === cell.owner);
                        if (player) {
                            ctx.fillStyle = player.color;
                            ctx.globalAlpha = cell.neuron_strength;
                            ctx.beginPath();
                            ctx.arc(
                                x * cellSize + cellSize / 2,
                                y * cellSize + cellSize / 2,
                                cellSize / 3,
                                0,
                                Math.PI * 2
                            );
                            ctx.fill();
                        }
                    }
                });
            });
            
            // Update consciousness level
            const level = gameState.consciousness_level * 100;
            document.getElementById('consciousness-level').style.width = level + '%';
            document.getElementById('consciousness-value').textContent = level.toFixed(1) + '%';
            
            // Update player info
            const playerInfo = document.getElementById('player-info');
            playerInfo.innerHTML = Object.values(gameState.players).map(player => `
                <div style="color: ${player.color}">
                    ${player.name}: ${player.score}점 (${player.neurons_placed} 뉴런)
                </div>
            `).join('');
        }
        
        // Handle board clicks
        document.getElementById('board-canvas').addEventListener('click', (e) => {
            if (!ws || ws.readyState !== WebSocket.OPEN) return;
            
            const canvas = e.target;
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / (canvas.width / 19));
            const y = Math.floor((e.clientY - rect.top) / (canvas.height / 19));
            
            ws.send(JSON.stringify({
                type: 'game_action',
                action: {
                    action: 'place_neuron',
                    x: x,
                    y: y
                }
            }));
        });
        
        function showStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.classList.add('active');
            
            setTimeout(() => {
                status.classList.remove('active');
            }, 3000);
        }
        
        // Initialize
        initNeuralBackground();
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('neural-bg');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>